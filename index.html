<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>20zão - Tudo por R$ 20,00</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff5000; /* Laranja estilo Shopee/Temu */
            --secondary: #ff0033; /* Vermelho oferta */
            --dark: #222;
            --light: #f5f5f5;
            --white: #fff;
            --gray: #999;
            --border: #e5e5e5;
            --success: #00bfa5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--light); color: var(--dark); padding-bottom: 60px; overflow-x: hidden; height: 100vh; }

        /* Utilitários */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .center { display: flex; justify-content: center; align-items: center; }
        .col { flex-direction: column; }
        .text-primary { color: var(--primary); }
        .strike { text-decoration: line-through; color: var(--gray); font-size: 0.8rem; }
        .price-tag { font-size: 1.2rem; font-weight: 900; color: var(--primary); }
        .btn { border: none; padding: 12px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; text-align: center; }
        .btn-primary { background: linear-gradient(to right, #ff9000, #ff5000); color: white; }
        .btn-secondary { background: white; border: 1px solid var(--border); color: var(--dark); }
        .container { max-width: 1200px; margin: 0 auto; padding: 10px; }

        /* Header */
        header { background: var(--white); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .top-bar { padding: 10px; display: flex; justify-content: space-between; align-items: center; background: var(--primary); color: white; font-size: 0.8rem; }
        .main-header { padding: 10px; display: flex; align-items: center; gap: 10px; }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary); letter-spacing: -1px; cursor: pointer;}
        .search-bar { flex: 1; position: relative; }
        .search-bar input { width: 100%; padding: 8px 35px 8px 10px; border: 1px solid var(--primary); border-radius: 4px; background: #f0f0f0; }
        .search-icon { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        /* Categorias */
        .categories-scroll { display: flex; overflow-x: auto; padding: 10px; gap: 15px; background: white; scrollbar-width: none; }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 60px; font-size: 0.75rem; color: #555; cursor: pointer; }
        .cat-item:hover .cat-img { border: 2px solid var(--primary); }
        .cat-img { width: 40px; height: 40px; background: #eee; border-radius: 50%; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; color: var(--primary); transition: 0.2s; }

        /* Banners */
        .hero-banner { background: var(--secondary); color: white; padding: 15px; border-radius: 8px; margin: 10px; text-align: center; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.9; } 100% { opacity: 1; } }
        
        /* Grid de Produtos */
        .section-title { padding: 15px 10px 5px; font-weight: 800; display: flex; justify-content: space-between; align-items: center; }
        .timer-badge { background: black; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 5px; }
        
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
        @media(min-width: 768px) { .product-grid { grid-template-columns: repeat(4, 1fr); } }

        .product-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s; position: relative; }
        .product-card:hover { transform: translateY(-3px); }
        .p-img-container { width: 100%; aspect-ratio: 1/1; overflow: hidden; position: relative; }
        .p-img-container img { width: 100%; height: 100%; object-fit: cover; }
        .discount-tag { position: absolute; top: 5px; right: 5px; background: rgba(255, 230, 0, 0.9); color: black; font-weight: bold; font-size: 0.7rem; padding: 2px 5px; border-radius: 2px; }
        .p-info { padding: 8px; }
        .p-name { font-size: 0.85rem; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; height: 2.4em; margin-bottom: 5px; }
        .stars { color: #ffc107; font-size: 0.7rem; margin-bottom: 5px; }
        .sold-count { font-size: 0.7rem; color: #777; float: right; }
        
        /* Wishlist Heart Icon on Card */
        .card-heart { position: absolute; top: 5px; left: 5px; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; color: #ccc; z-index: 10; }
        .card-heart.liked { color: var(--secondary); }

        /* Página de Produto Detalhada (CORREÇÃO DE SCROLL) */
        #product-view { 
            background: #f0f0f0; 
            height: 100%; /* Mudança de min-height para height */
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            z-index: 200; 
            overflow-y: auto; /* Garante scroll */
            -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
            padding-bottom: 80px; 
        }
        
        .p-header-nav { position: absolute; top: 10px; left: 10px; z-index: 10; }
        .back-btn { background: rgba(0,0,0,0.5); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; backdrop-filter: blur(5px); }
        .main-image { width: 100%; height: 400px; object-fit: cover; background: white; }
        .thumbs { display: flex; gap: 10px; padding: 10px; overflow-x: auto; background: white; }
        .thumb { width: 60px; height: 60px; border: 1px solid #ddd; object-fit: cover; border-radius: 4px; }
        .thumb.active { border: 2px solid var(--primary); }
        
        .p-details { padding: 15px; background: white; border-radius: 20px 20px 0 0; margin-top: -20px; position: relative; margin-bottom: 10px; min-height: 500px; }
        .shipping-info { background: #e8f7f5; padding: 10px; border-radius: 4px; margin: 15px 0; font-size: 0.85rem; display: flex; align-items: center; gap: 10px; color: #00796b; }
        
        /* Options Buttons */
        .option-btn { padding: 8px 15px; border: 1px solid #ccc; border-radius: 20px; background: white; margin-right: 8px; margin-bottom: 8px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; }
        .option-btn.selected { border: 1px solid var(--primary); background: #fff0e6; color: var(--primary); font-weight: bold; }

        /* Reviews Section */
        .reviews-box { background: white; padding: 15px; margin-top: 10px; margin-bottom: 20px;}
        .review-card { border-bottom: 1px solid #eee; padding: 15px 0; }
        .review-header { display: flex; align-items: center; margin-bottom: 5px; }
        .user-avatar { width: 30px; height: 30px; background: #ddd; border-radius: 50%; margin-right: 10px; display: flex; align-items: center; justify-content: center; color: #777; font-size: 0.8rem; }
        .user-name { font-size: 0.9rem; font-weight: 500; margin-right: 10px; }
        .review-date { font-size: 0.7rem; color: #999; margin-left: auto; }
        
        /* Form de Avaliação */
        #review-form { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #eee; }
        #review-text { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; resize: vertical; }
        .star-select { font-size: 1.5rem; color: #ddd; cursor: pointer; }
        .star-select.active { color: #ffc107; }

        /* Related Products */
        .related-box { padding: 15px; padding-bottom: 100px; /* Espaço extra para scroll */ }
        
        /* Página de Checkout/Forms */
        .form-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 300; padding: 20px; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; }
        
        /* Perfil View */
        .profile-header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 20px 20px; margin-bottom: 20px;}
        .profile-card { background: white; padding: 15px; margin: 10px; border-radius: 8px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .history-item { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .history-img { width: 50px; height: 50px; border-radius: 4px; object-fit: cover; }
        
        /* Pagamento */
        .payment-loader { text-align: center; margin-top: 50px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .pix-container { text-align: center; padding: 20px; background: #f9f9f9; border-radius: 8px; margin-top: 20px; border: 1px dashed var(--primary); }
        .pix-code { word-break: break-all; font-family: monospace; background: white; padding: 10px; border: 1px solid #eee; margin: 10px 0; font-size: 0.8rem; }
        
        /* Modal +18 */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: white; padding: 30px; border-radius: 8px; text-align: center; max-width: 400px; width: 100%; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .modal-box h2 { color: var(--primary); margin-bottom: 15px; }
        .modal-box p { margin-bottom: 20px; color: #666; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 10px 0; z-index: 90; }
        .nav-item { text-align: center; font-size: 0.7rem; color: #999; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 3px; display: block; }

    </style>
</head>
<body>

<div id="age-modal" class="modal-overlay">
    <div class="modal-box">
        <i class="fas fa-user-shield fa-3x text-primary" style="margin-bottom: 15px;"></i>
        <h2>Verificação de Idade</h2>
        <p>Bem-vindo à 20zão! Para acessar ofertas exclusivas e produtos importados, você precisa confirmar que tem mais de 18 anos.</p>
        <button class="btn btn-primary" onclick="confirmAge()">SOU MAIOR DE 18 ANOS</button>
    </div>
</div>

<div id="app" class="hidden">

    <div id="home-view" class="view-section">
        <header>
            <div class="top-bar">
                <span><i class="fas fa-check-circle"></i> Garantia de Entrega</span>
                <span><i class="fas fa-sync"></i> Devolução Grátis</span>
            </div>
            <div class="main-header">
                <div class="logo" onclick="resetFilters()">20zão</div>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Buscar na 20zão..." onkeyup="searchProducts(this.value)">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <div style="font-size: 1.2rem; color: var(--primary); cursor: pointer;" onclick="toggleSort()">
                    <i class="fas fa-filter"></i>
                </div>
            </div>
        </header>

        <div class="categories-scroll">
            <div class="cat-item" onclick="resetFilters()"><div class="cat-img"><i class="fas fa-th-large"></i></div>Todos</div>
            <div class="cat-item" onclick="filterCategory('Acessórios')"><div class="cat-img"><i class="fas fa-glasses"></i></div>Acessórios</div>
            <div class="cat-item" onclick="filterCategory('Moda')"><div class="cat-img"><i class="fas fa-tshirt"></i></div>Roupas</div>
            <div class="cat-item" onclick="filterCategory('Eletrônicos')"><div class="cat-img"><i class="fas fa-laptop"></i></div>Eletrônicos</div>
            <div class="cat-item" onclick="filterCategory('Casa')"><div class="cat-img"><i class="fas fa-home"></i></div>Casa</div>
            <div class="cat-item" onclick="filterCategory('Brinquedos')"><div class="cat-img"><i class="fas fa-gamepad"></i></div>Brinquedos</div>
            <div class="cat-item" onclick="filterCategory('Ferramentas')"><div class="cat-img"><i class="fas fa-tools"></i></div>Ferramentas</div>
        </div>

        <div class="hero-banner">
            <h2><i class="fas fa-clock"></i> OFERTAS RELÂMPAGO</h2>
            <p>Tudo por apenas R$ 20,00 - Tempo Limitado!</p>
        </div>

        <div class="container" style="background: #fff5f0; padding: 15px; border-radius: 8px; margin: 10px; font-size: 0.9rem; border: 1px solid #ffccbc;">
            <p style="color: var(--primary); font-weight: bold;"><i class="fas fa-store"></i> Sobre a 20zão</p>
            <p style="margin-top:5px; color: #555;">
                Somos a revolução do varejo direto! Conectamos você às melhores fábricas internacionais sem intermediários. Nossa missão é simples: preço único, qualidade máxima e surpresas incríveis.
            </p>
        </div>

        <div class="section-title">
            <span id="list-title">Mais Vendidos do Dia <i class="fas fa-fire text-primary"></i></span>
            <span class="timer-badge" id="main-timer">20:00:00</span>
        </div>

        <div class="product-grid" id="product-container">
            </div>
        
        <div style="height: 60px;"></div> </div>

    <div id="wishlist-view" class="view-section hidden">
        <header>
             <div class="main-header" style="justify-content: center;">
                <div class="logo">Lista de Desejos</div>
             </div>
        </header>
        <div class="container">
            <div class="section-title">
                <span>Seus Favoritos</span>
            </div>
            <div id="wishlist-container" class="product-grid">
                </div>
             <div id="empty-wishlist-msg" class="hidden" style="text-align: center; padding: 50px; color: #999;">
                <i class="far fa-heart fa-3x"></i>
                <p style="margin-top: 10px;">Sua lista está vazia.</p>
                <button class="btn btn-primary" style="width: auto; margin-top: 10px;" onclick="switchTab('home')">Ir as Compras</button>
            </div>
        </div>
        <div style="height: 60px;"></div>
    </div>

    <div id="profile-view" class="view-section hidden">
        <div class="profile-header">
            <i class="fas fa-user-circle fa-4x"></i>
            <h2 style="margin-top: 10px;" id="profile-name-display">Visitante</h2>
        </div>
        
        <div class="container">
            <div class="profile-card">
                <h3><i class="fas fa-history text-primary"></i> Histórico de Pedidos</h3>
                <div id="history-container" style="margin-top: 10px;">
                    <p style="font-size: 0.9rem; color: #777;">Nenhum pedido recente.</p>
                </div>
            </div>

            <div class="profile-card">
                <h3><i class="fas fa-id-card text-primary"></i> Meus Dados</h3>
                <p style="color: #666; font-size: 0.8rem; margin-bottom: 15px;">Informações salvas para compras futuras.</p>
                
                <div id="saved-data-display">
                    <p><strong>CPF:</strong> <span id="display-cpf">Não informado</span></p>
                    <p><strong>Endereço:</strong> <span id="display-addr">Não informado</span></p>
                    <p><strong>Número:</strong> <span id="display-num">--</span></p>
                    <p><strong>Bairro:</strong> <span id="display-bairro">--</span></p>
                    <p><strong>Cidade:</strong> <span id="display-city">--</span></p>
                </div>
                <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                <button class="btn btn-secondary" onclick="clearUserData()">Limpar Meus Dados</button>
            </div>
        </div>
        <div style="height: 60px;"></div>
    </div>

    <div id="product-view" class="hidden">
        <div class="p-header-nav">
            <div class="back-btn" onclick="goBackToHome()">
                <i class="fas fa-arrow-left"></i>
            </div>
        </div>
        
        <div id="product-content">
            </div>
    </div>

    <div id="checkout-form-view" class="form-screen hidden">
        <div class="section-title">
            <span><i class="fas fa-map-marker-alt"></i> Endereço de Entrega</span>
            <span onclick="goBackToProduct()" style="font-size: 0.8rem; color: var(--primary);">Voltar</span>
        </div>
        <p style="font-size: 0.8rem; color: #666; margin-bottom: 20px;">Precisamos dos seus dados para a Nota Fiscal e Envio.</p>
        
        <form onsubmit="submitForm(event)">
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" id="fname" required placeholder="Ex: João Silva">
            </div>
            <div class="form-group">
                <label>CPF (Para Nota Fiscal)</label>
                <input type="text" id="fcpf" required placeholder="000.000.000-00">
            </div>
            <div class="form-group">
                <label>CEP</label>
                <input type="text" id="fcep" required placeholder="00000-000">
            </div>
            <div class="form-group">
                <label>Endereço (Rua, Av)</label>
                <input type="text" id="faddr" required>
            </div>
            <div class="form-group" style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>Número</label>
                    <input type="text" id="fnum" required>
                </div>
                <div style="flex: 2;">
                    <label>Bairro</label>
                    <input type="text" id="fbairro" required>
                </div>
            </div>
            <div class="form-group">
                <label>Município / Estado</label>
                <input type="text" id="fcity" required>
            </div>
            <div class="form-group">
                <label>Ponto de Referência</label>
                <input type="text" id="fref">
            </div>

            <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <p><strong>Resumo do Pedido:</strong></p>
                <p id="checkout-product-name" style="font-size: 0.9rem; margin: 5px 0;">Produto...</p>
                <div id="checkout-variant" style="font-size: 0.8rem; color: #666; margin-bottom: 5px;"></div>
                <hr style="border: 0; border-top: 1px solid #ddd; margin: 10px 0;">
                <div class="flex justify-between" style="justify-content: space-between;">
                    <span>Subtotal</span>
                    <span>R$ 20,00</span>
                </div>
                <div class="flex justify-between" style="justify-content: space-between; color: var(--success); font-weight: bold;">
                    <span>Frete (Envio Padrão)</span>
                    <span>GRÁTIS</span>
                </div>
                <div class="flex justify-between" style="justify-content: space-between; margin-top: 10px; font-weight: 900; font-size: 1.1rem;">
                    <span>Total</span>
                    <span>R$ 20,00</span>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">IR PARA PAGAMENTO</button>
        </form>
    </div>

    <div id="loading-view" class="form-screen hidden center col">
        <div class="spinner"></div>
        <h3>Processando Pedido...</h3>
        <p>Gerando código seguro de pagamento</p>
    </div>

    <div id="payment-view" class="form-screen hidden">
        <div class="section-title">
            <span>Pagamento Pix</span>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo%E2%80%94pix_powered_by_Banco_Central_%28Brazil%2C_2020%29.svg/2560px-Logo%E2%80%94pix_powered_by_Banco_Central_%28Brazil%2C_2020%29.svg.png" width="100" alt="Pix Logo">
            
            <p style="margin: 20px 0; color: var(--secondary); font-weight: bold;">
                <i class="fas fa-clock"></i> Pague dentro de: <span id="pix-timer">20:00:00</span>
            </p>

            <div class="pix-container">
                <img id="qr-image" src="" alt="QR Code Pix" style="width: 200px; height: 200px;">
                <p style="font-size: 0.9rem; margin-top: 10px;">Escaneie o QR Code acima</p>
            </div>

            <p style="margin-top: 20px;">Ou copie o código abaixo:</p>
            <div class="pix-code" id="pix-string">
                00020126580014BR.GOV.BCB.PIX01361c729f04-a046-4310-bdf5-1ead5d34bfc5520400005303986540520.005802BR5925Wendel dos Santos Oliveir6009SAO PAULO621405101Pr9y22qjO6304618C
            </div>
            
            <button class="btn btn-secondary" onclick="copyPix()">
                <i class="fas fa-copy"></i> COPIAR CÓDIGO PIX
            </button>

            <br><br>
            <a href="https://nubank.com.br/cobrar/1ku07b/69435095-4eea-49ec-bc22-443c75204515" target="_blank" class="btn btn-primary" style="display: block; text-decoration: none; line-height: 20px;">
                ABRIR LINK DE PAGAMENTO
            </a>
            
            <div style="margin-top: 30px; font-size: 0.8rem; color: #777;">
                <p><i class="fas fa-info-circle"></i> Após o pagamento, clique no botão abaixo para liberar seu pedido e a nota fiscal.</p>
                <button class="btn btn-secondary" style="margin-top: 10px; border-color: var(--success); color: var(--success); font-weight:bold;" onclick="confirmPurchase()">
                    <i class="fas fa-check"></i> JÁ PAGUEI / ATUALIZAR
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="nav-home" onclick="switchTab('home')">
            <i class="fas fa-home"></i> Início
        </div>
        <div class="nav-item" id="nav-wish" onclick="switchTab('wish')">
            <i class="fas fa-heart"></i> Desejos
        </div>
        <div class="nav-item" id="nav-profile" onclick="switchTab('profile')">
            <i class="fas fa-user"></i> Perfil
        </div>
    </div>
</div>

<script>
    // --- DADOS DOS PRODUTOS ---
    const products = [
        {
            id: 1,
            name: "Mochila 50L Reforçada Impermeável Tática Militar",
            category: "Acessórios",
            oldPrice: 189.90,
            images: [
                "https://img.kwcdn.com/local-image/s132/20add7001e/ab8221c6-e44e-4307-b4ca-f670d5c9dc9c.jpeg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/local-image/s132/20add7001e/d879d5c8-52d5-4666-9abf-434c1f58ae8c.jpeg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif"
            ],
            desc: "Ideal para camping, viagens e uso diário. Material Oxford 900D de alta densidade, resistente à água e rasgos. Design ergonômico com múltiplos compartimentos.",
            options: ["Preta", "Verde Militar", "Caqui"],
            rating: 4.8,
            reviews: 1240
        },
        {
            id: 2,
            name: "Parafusadeira Furadeira Impacto 48V + Maleta",
            category: "Ferramentas",
            oldPrice: 350.00,
            images: [
                "https://img.kwcdn.com/local-image/s132/20add701c8/e72b7abf-2ece-4086-8eaa-3c52f77f7a9a_800x800.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/local-image/s132/20add701c8/032deb2b-fdbf-4cdf-a0e6-500efbf16b6a_1024x1024.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/local-image/s132/20add701c8/ad63295d-f6bf-4eac-80fc-84806b7c7320_1024x1024.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif"
            ],
            desc: "Potência industrial na palma da mão. Inclui 2 baterias de longa duração, carregador bivolt e kit de bits. Função martelete para concreto.",
            options: ["Padrão 48V", "Kit Completo"],
            rating: 4.9,
            reviews: 3200
        },
        {
            id: 3,
            name: "Relógio de Quartzo Cravejado Diamante Aço Inox",
            category: "Acessórios",
            oldPrice: 499.00,
            images: [
                "https://img.kwcdn.com/product/1d14c6c1592/9aa00d8c-56bb-4efb-b06e-a793c47d3821_1200x1200.jpeg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/product/enhanced_images/99ab7c19284e5ba6cbd11eef6b2457e9_enhanced.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/product/1d14c6c1592/84b43ba7-7a0d-4f1e-aa49-ef61f324956b_800x800.jpeg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif"
            ],
            desc: "Elegância pura. Banhado a ouro 18k com pedras de zircônia cúbica AAA. À prova d'água (3ATM) e não perde a cor.",
            options: ["Dourado Vermelho", "Dourado Verde", "Prata Azul"],
            rating: 5.0,
            reviews: 850
        },
        {
            id: 4,
            name: "Patinete Elétrico Hoverboard Bluetooth LED",
            category: "Eletrônicos",
            oldPrice: 800.00,
            images: [
                "https://img.kwcdn.com/local-image/s132/20add7005a/45c08d1d-576f-4ea6-94d9-7cceec13dc54_1200x1200.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/local-image/s132/20add7005a/4f91601d-833b-4489-9330-eb4c5a5444f4_1200x1200.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif",
                "https://img.kwcdn.com/local-image/s132/20add7005a/07950eea-6402-4372-a218-589b7d02068d_1200x1200.jpeg.format.jpg?imageMogr2/auto-orient%7CimageView2/2/w/800/q/70/format/avif"
            ],
            desc: "Diversão garantida. Sistema de auto-equilíbrio inteligente, bateria Samsung de longa duração e luzes LED RGB. Suporta até 100kg.",
            options: ["Galáxia", "Roxo", "Camuflado", "Grafite"],
            rating: 4.7,
            reviews: 540
        },
        {
            id: 5,
            name: "Action Figure Dragon Ball Z - Colecionável Premium",
            category: "Brinquedos",
            oldPrice: 89.90,
            images: [
                "https://down-br.img.susercontent.com/file/sg-11134201-7rcdb-m6mnb4ebzbw2ec@resize_w1080_nl.webp",
                "https://down-br.img.susercontent.com/file/sg-11134201-7rcf4-m6mnbelp34ss6f@resize_w1080_nl.webp",
                "https://down-br.img.susercontent.com/file/sg-11134201-7rcev-m6mnbi8nq1bd2a@resize_w1080_nl.webp"
            ],
            desc: "Detalhamento impressionante. Figuras de 18cm com pintura realista. Perfeito para decorar seu setup ou estante.",
            options: ["Goku Ultra Instinct", "Goku Black", "Majin Boo", "Goku SSJ God"],
            rating: 4.9,
            reviews: 2100
        },
        {
            id: 6,
            name: "Kit 4 Camisetas Streetwear Masculina Algodão",
            category: "Moda",
            oldPrice: 120.00,
            images: [
                "https://img.kwcdn.com/product/fmket/7c3b17835f6e60f330f9eaf12222ed36.jpg?imageView2/2/w/375/q/80/format/avif"
            ],
            desc: "Estilo e conforto. Algodão fio 30.1 penteado que não encolhe. Estampas em silk screen de alta durabilidade.",
            options: ["P", "M", "G", "GG"],
            rating: 4.6,
            reviews: 4000
        },
        {
            id: 7,
            name: "Serra Mármore Makita 4100 NH2Z 110V Profissional",
            category: "Ferramentas",
            oldPrice: 450.00,
            images: [
                "https://images.tcdn.com.br/img/img_prod/1022417/serra_marmore_makita_4100_nh2z_110v_1157_1_63b596b070cd35779ada089541e11489.png",
                "https://images.tcdn.com.br/img/img_prod/1022417/serra_marmore_makita_4100_nh2z_110v_1157_3_740039fd9c855ca5f44b4d09a7ef1c9a.jpg"
            ],
            desc: "A lenda da construção civil. Motor potente para cortes em pisos, azulejos e concreto. Design compacto e leve.",
            options: ["110V"],
            rating: 5.0,
            reviews: 900
        },
        {
            id: 8,
            name: "Frigobar 47L Branco Elgin Com Porta Reversível",
            category: "Casa",
            oldPrice: 999.00,
            images: [
                "https://ultrafeu.vtexassets.com/arquivos/ids/168925-900-900/8.png?v=638938866754100000",
                "https://ultrafeu.vtexassets.com/arquivos/ids/168926-900-900/1.png?v=638938866754270000"
            ],
            desc: "Compacto por fora, gigante por dentro. Classificação A em energia. Compartimento extra frio para gelar bebidas rapidamente.",
            options: ["110V", "220V"],
            rating: 4.9,
            reviews: 150
        }
    ];

    let currentProduct = null;
    let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
    let purchasedItems = JSON.parse(localStorage.getItem('purchasedItems')) || [];
    let userReviews = JSON.parse(localStorage.getItem('userReviews')) || {}; // { productId: [ {name, text, stars, date} ] }
    let isAscending = false;
    let selectedVariant = null;
    let selectedRating = 0;

    // --- FUNÇÕES DE INICIALIZAÇÃO E UI ---

    function confirmAge() {
        document.getElementById('age-modal').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        renderProducts(products); // Renderiza todos inicialmente
        startTimer('main-timer', 20);
        loadUserData();
    }

    // Função de Renderização Atualizada
    function renderProducts(list) {
        const container = document.getElementById('product-container');
        
        if(list.length === 0) {
            container.innerHTML = '<div style="grid-column: span 2; text-align:center; padding: 20px;">Nenhum produto encontrado.</div>';
            return;
        }

        container.innerHTML = list.map(p => {
            const isLiked = wishlist.includes(p.id) ? 'liked' : '';
            const heartIcon = isLiked ? 'fas' : 'far';
            
            return `
            <div class="product-card">
                <div class="card-heart ${isLiked}" onclick="toggleWishlist(${p.id}, event)">
                    <i class="${heartIcon} fa-heart"></i>
                </div>
                <div onclick="openProduct(${p.id})">
                    <div class="p-img-container">
                        <span class="discount-tag">-90%</span>
                        <img src="${p.images[0]}" alt="${p.name}">
                    </div>
                    <div class="p-info">
                        <div class="p-name">${p.name}</div>
                        <div class="stars">
                            ${getStars(p.rating)} (${p.reviews})
                        </div>
                        <div>
                            <span class="strike">R$ ${p.oldPrice.toFixed(2)}</span>
                        </div>
                        <div class="flex" style="justify-content: space-between; align-items: center;">
                            <span class="price-tag">R$ 20,00</span>
                            <span class="sold-count">2mil+ vend.</span>
                        </div>
                    </div>
                </div>
            </div>
        `}).join('');
    }

    function getStars(rating) {
        let stars = '';
        for(let i=0; i<5; i++) {
            if(i < Math.floor(rating)) stars += '<i class="fas fa-star"></i>';
            else stars += '<i class="far fa-star"></i>';
        }
        return stars;
    }

    // --- PESQUISA E FILTROS ---

    function searchProducts(query) {
        const filtered = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
        renderProducts(filtered);
        document.getElementById('list-title').innerHTML = query ? `Resultados para "${query}"` : 'Mais Vendidos do Dia <i class="fas fa-fire text-primary"></i>';
    }

    function filterCategory(category) {
        document.getElementById('searchInput').value = ''; // Limpa pesquisa
        const filtered = products.filter(p => p.category === category);
        renderProducts(filtered);
        document.getElementById('list-title').innerHTML = `Categoria: ${category}`;
    }

    function resetFilters() {
        document.getElementById('searchInput').value = '';
        renderProducts(products);
        document.getElementById('list-title').innerHTML = 'Mais Vendidos do Dia <i class="fas fa-fire text-primary"></i>';
    }

    function toggleSort() {
        isAscending = !isAscending;
        const sorted = [...products].sort((a, b) => {
            return isAscending ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
        });
        renderProducts(sorted);
        alert(isAscending ? "Ordenado de A-Z" : "Ordenado de Z-A");
    }

    // --- WISHLIST ---

    function toggleWishlist(id, event) {
        if(event) event.stopPropagation(); 

        if(wishlist.includes(id)) {
            wishlist = wishlist.filter(item => item !== id);
        } else {
            wishlist.push(id);
        }
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        
        if(!document.getElementById('wishlist-view').classList.contains('hidden')){
            renderWishlist();
        } else {
            const currentSearch = document.getElementById('searchInput').value;
            if(currentSearch) searchProducts(currentSearch);
            else renderProducts(products);
        }
    }

    function renderWishlist() {
        const container = document.getElementById('wishlist-container');
        const emptyMsg = document.getElementById('empty-wishlist-msg');
        
        if(wishlist.length === 0) {
            container.innerHTML = '';
            emptyMsg.classList.remove('hidden');
            return;
        }

        emptyMsg.classList.add('hidden');
        const wishProducts = products.filter(p => wishlist.includes(p.id));
        
        container.innerHTML = wishProducts.map(p => `
            <div class="product-card">
                 <div class="card-heart liked" onclick="toggleWishlist(${p.id}, event)">
                    <i class="fas fa-heart"></i>
                </div>
                <div onclick="openProduct(${p.id})">
                    <div class="p-img-container">
                        <img src="${p.images[0]}" alt="${p.name}">
                    </div>
                    <div class="p-info">
                        <div class="p-name">${p.name}</div>
                         <div class="flex" style="justify-content: space-between; align-items: center;">
                            <span class="price-tag">R$ 20,00</span>
                        </div>
                         <button class="btn btn-primary" style="margin-top:5px; padding: 5px; font-size:0.8rem;">Comprar</button>
                    </div>
                </div>
            </div>
        `).join('');
    }


    // --- NAVEGAÇÃO ENTRE ABAS ---

    function switchTab(tab) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('product-view').classList.add('hidden');
        document.getElementById('checkout-form-view').classList.add('hidden');
        document.getElementById('payment-view').classList.add('hidden');

        if(tab === 'home') {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('nav-home').classList.add('active');
            renderProducts(products); 
        } else if (tab === 'wish') {
            document.getElementById('wishlist-view').classList.remove('hidden');
            document.getElementById('nav-wish').classList.add('active');
            renderWishlist();
        } else if (tab === 'profile') {
            document.getElementById('profile-view').classList.remove('hidden');
            document.getElementById('nav-profile').classList.add('active');
            updateProfileUI();
        }
        window.scrollTo(0,0);
    }

    // --- DETALHES DO PRODUTO (NOVA PÁGINA) ---

    function goBackToHome() {
        document.getElementById('product-view').classList.add('hidden');
        document.body.style.overflow = 'auto'; // Reabilita scroll do body
    }

    function openProduct(id) {
        currentProduct = products.find(p => p.id === id);
        selectedVariant = null; 
        const view = document.getElementById('product-view');
        const content = document.getElementById('product-content');
        const isLiked = wishlist.includes(id);
        const hasPurchased = purchasedItems.includes(id);

        // Gerar Imagens
        let thumbsHtml = currentProduct.images.map((img, idx) => 
            `<img src="${img}" class="thumb ${idx===0?'active':''}" onclick="changeMainImage(this.src, this)">`
        ).join('');

        // Gerar Opções
        let optionsHtml = currentProduct.options.map(opt => 
            `<button class="option-btn" onclick="selectOption(this, '${opt}')">${opt}</button>`
        ).join('');

        // Produtos Relacionados
        const related = products.filter(p => p.id !== currentProduct.id).sort(() => 0.5 - Math.random()).slice(0, 4);
        let relatedHtml = related.map(rp => `
            <div class="product-card" onclick="openProduct(${rp.id});">
                <div class="p-img-container">
                    <span class="discount-tag">-90%</span>
                    <img src="${rp.images[0]}" alt="${rp.name}">
                </div>
                <div class="p-info">
                    <div class="p-name" style="font-size: 0.8rem;">${rp.name}</div>
                    <span class="price-tag" style="font-size: 1rem;">R$ 20,00</span>
                </div>
            </div>
        `).join('');

        // Avaliações (Fakes + Reais salvas)
        const fakeReviews = [
            { name: "Maria S.", text: "Amei o produto! Chegou antes do prazo e a qualidade é surpreendente pelo preço.", date: "Há 2 dias", stars: 5 },
            { name: "Carlos A.", text: "Muito bom, exatamente como na foto. Recomendo a todos.", date: "Há 1 semana", stars: 5 },
            { name: "Fernanda L.", text: "Valeu cada centavo. Vou comprar mais coisas na 20zão.", date: "Há 3 semanas", stars: 4 },
            { name: "João P.", text: "Produto top! Veio bem embalado.", date: "Há 1 mês", stars: 5 }
        ];

        // Adiciona avaliações reais do usuário
        const savedReviews = userReviews[id] || [];
        const allReviews = [...savedReviews, ...fakeReviews];

        let reviewsHtml = allReviews.map(r => `
            <div class="review-card">
                <div class="review-header">
                    <div class="user-avatar"><i class="fas fa-user"></i></div>
                    <div class="user-name">${r.name}</div>
                    <div style="color: #ffc107; font-size: 0.8rem;">${getStars(r.stars)}</div>
                    <span class="review-date">${r.date}</span>
                </div>
                <p style="font-size: 0.9rem; color: #555;">${r.text}</p>
            </div>
        `).join('');

        // Monta o HTML da página do produto
        content.innerHTML = `
            <img id="main-prod-img" src="${currentProduct.images[0]}" class="main-image">
            <div class="thumbs">${thumbsHtml}</div>
            
            <div class="p-details">
                <div class="flex" style="justify-content: space-between; align-items: flex-start;">
                    <h1 style="font-size: 1.2rem; width: 70%; line-height: 1.3;">${currentProduct.name}</h1>
                    <div style="text-align: right;">
                         <span class="strike">R$ ${currentProduct.oldPrice.toFixed(2)}</span><br>
                         <span class="price-tag" style="font-size: 1.8rem;">R$ 20,00</span>
                    </div>
                </div>
                
                <div style="color: #ffc107; font-size: 0.9rem; margin: 10px 0;">
                    ${getStars(currentProduct.rating)} ${currentProduct.rating} | ${currentProduct.reviews} Avaliações
                </div>

                <div style="margin: 15px 0;">
                    <p style="font-weight: bold; margin-bottom: 5px;">Escolha a variação:</p>
                    <div style="display: flex; flex-wrap: wrap;">${optionsHtml}</div>
                    <p id="var-error" style="color: red; font-size: 0.8rem; display: none; margin-top:5px;">* Por favor, selecione uma opção antes de comprar.</p>
                </div>

                <div class="shipping-info">
                    <i class="fas fa-truck"></i>
                    <div>
                        <strong>Frete Grátis para todo Brasil</strong><br>
                        Chega entre 2 a 10 dias úteis (Envio Nacional)
                    </div>
                </div>

                <div style="margin: 20px 0; font-size: 0.9rem; color: #444; line-height: 1.5;">
                    <h3 style="margin-bottom: 10px;">Descrição</h3>
                    <p>${currentProduct.desc}</p>
                </div>

                <div class="reviews-box">
                    <div class="flex" style="justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3>Avaliações</h3>
                    </div>
                    
                    <div id="review-list">
                        ${reviewsHtml}
                    </div>

                    ${!hasPurchased ? `
                        <button class="btn btn-secondary" style="margin-top: 15px;" onclick="alert('Você precisa comprar este produto para deixar uma avaliação!')">
                            <i class="fas fa-pen"></i> Deixar minha avaliação
                        </button>
                    ` : `
                        <button class="btn btn-secondary" style="margin-top: 15px;" onclick="document.getElementById('review-form').classList.remove('hidden'); this.style.display='none';">
                            <i class="fas fa-pen"></i> Avaliar Produto
                        </button>
                        
                        <div id="review-form" class="hidden">
                            <h4>Escreva sua avaliação</h4>
                            <div style="margin: 10px 0;">
                                <i class="fas fa-star star-select" onclick="setRate(1)" id="star-1"></i>
                                <i class="fas fa-star star-select" onclick="setRate(2)" id="star-2"></i>
                                <i class="fas fa-star star-select" onclick="setRate(3)" id="star-3"></i>
                                <i class="fas fa-star star-select" onclick="setRate(4)" id="star-4"></i>
                                <i class="fas fa-star star-select" onclick="setRate(5)" id="star-5"></i>
                            </div>
                            <textarea id="review-text" rows="3" placeholder="O que achou do produto?"></textarea>
                            <button class="btn btn-primary" onclick="submitReview()">Enviar Avaliação</button>
                        </div>
                    `}
                </div>

                <div class="related-box">
                    <h3 style="margin-bottom: 15px;">Você também pode gostar</h3>
                    <div class="product-grid" style="grid-template-columns: repeat(2, 1fr); padding: 0;">
                        ${relatedHtml}
                    </div>
                </div>
            </div>

            <div style="position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; gap: 10px; z-index: 201;">
                <button class="btn btn-secondary" style="width: 50px; font-size: 1.2rem; color: ${isLiked ? 'var(--secondary)' : '#333'}" onclick="toggleWishlist(${currentProduct.id}); openProduct(${currentProduct.id})">
                    <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                </button>
                <button class="btn btn-primary" onclick="goToCheckout()">COMPRAR AGORA</button>
            </div>
        `;

        view.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Trava scroll da home
        view.scrollTop = 0; // Reseta scroll da modal
    }

    function changeMainImage(src, el) {
        document.getElementById('main-prod-img').src = src;
        document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
    }

    function selectOption(btn, value) {
        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedVariant = value;
        document.getElementById('var-error').style.display = 'none';
    }

    // --- LÓGICA DE AVALIAÇÃO ---

    function setRate(star) {
        selectedRating = star;
        for(let i=1; i<=5; i++) {
            const el = document.getElementById(`star-${i}`);
            if(i <= star) el.classList.add('active');
            else el.classList.remove('active');
        }
    }

    function submitReview() {
        if(selectedRating === 0) {
            alert("Selecione uma nota em estrelas.");
            return;
        }
        const text = document.getElementById('review-text').value;
        if(!text) {
            alert("Escreva um comentário.");
            return;
        }

        const userData = JSON.parse(localStorage.getItem('user_data')) || { name: "Cliente" };
        const newReview = {
            name: userData.name,
            text: text,
            date: "Agora",
            stars: selectedRating
        };

        // Salvar review
        if(!userReviews[currentProduct.id]) userReviews[currentProduct.id] = [];
        userReviews[currentProduct.id].unshift(newReview);
        localStorage.setItem('userReviews', JSON.stringify(userReviews));

        alert("Avaliação enviada com sucesso!");
        openProduct(currentProduct.id); // Recarrega para mostrar a review
    }

    // --- CHECKOUT E DADOS ---

    function loadUserData() {
        const savedData = JSON.parse(localStorage.getItem('user_data'));
        if (savedData) {
            document.getElementById('fname').value = savedData.name || '';
            document.getElementById('fcpf').value = savedData.cpf || '';
            document.getElementById('fcep').value = savedData.cep || '';
            document.getElementById('faddr').value = savedData.addr || '';
            document.getElementById('fnum').value = savedData.num || '';
            document.getElementById('fbairro').value = savedData.bairro || '';
            document.getElementById('fcity').value = savedData.city || '';
            document.getElementById('fref').value = savedData.ref || '';
        }
    }

    function updateProfileUI() {
        const savedData = JSON.parse(localStorage.getItem('user_data'));
        const historyContainer = document.getElementById('history-container');
        
        // Dados Pessoais
        if (savedData) {
            document.getElementById('profile-name-display').innerText = savedData.name;
            document.getElementById('display-cpf').innerText = savedData.cpf;
            document.getElementById('display-addr').innerText = savedData.addr + ', ' + savedData.cep;
            document.getElementById('display-num').innerText = savedData.num;
            document.getElementById('display-bairro').innerText = savedData.bairro;
            document.getElementById('display-city').innerText = savedData.city;
        } else {
            document.getElementById('profile-name-display').innerText = "Visitante";
            document.getElementById('display-cpf').innerText = "Não informado";
            document.getElementById('display-addr').innerText = "Não informado";
        }

        // Histórico de Compras
        if(purchasedItems.length > 0) {
            const myProducts = products.filter(p => purchasedItems.includes(p.id));
            historyContainer.innerHTML = myProducts.map(p => `
                <div class="history-item">
                    <img src="${p.images[0]}" class="history-img">
                    <div>
                        <div style="font-weight:bold; font-size:0.9rem;">${p.name}</div>
                        <div style="font-size:0.8rem; color: green;">Entregue</div>
                        <button class="btn-secondary" style="padding:2px 8px; font-size:0.7rem; margin-top:5px;" onclick="switchTab('home'); openProduct(${p.id})">Avaliar / Comprar Novamente</button>
                    </div>
                </div>
            `).join('');
        } else {
            historyContainer.innerHTML = '<p style="font-size: 0.9rem; color: #777;">Nenhum pedido recente.</p>';
        }
    }

    function goToCheckout() {
        if(!selectedVariant && currentProduct.options.length > 0) {
            document.getElementById('var-error').style.display = 'block';
            // Scroll dentro do modal para mostrar o erro
            document.getElementById('product-view').scrollTo({
                top: 200,
                behavior: 'smooth'
            });
            return;
        }

        loadUserData(); 
        document.getElementById('checkout-product-name').innerText = currentProduct.name;
        document.getElementById('checkout-variant').innerText = selectedVariant ? `Opção: ${selectedVariant}` : '';
        document.getElementById('checkout-form-view').classList.remove('hidden');
    }

    function goBackToProduct() {
        document.getElementById('checkout-form-view').classList.add('hidden');
    }

    function submitForm(e) {
        e.preventDefault();
        
        const userData = {
            name: document.getElementById('fname').value,
            cpf: document.getElementById('fcpf').value,
            cep: document.getElementById('fcep').value,
            addr: document.getElementById('faddr').value,
            num: document.getElementById('fnum').value,
            bairro: document.getElementById('fbairro').value,
            city: document.getElementById('fcity').value,
            ref: document.getElementById('fref').value
        };
        localStorage.setItem('user_data', JSON.stringify(userData));

        document.getElementById('checkout-form-view').classList.add('hidden');
        document.getElementById('loading-view').classList.remove('hidden');

        // Gera QR Code
        const pixString = document.getElementById('pix-string').innerText.trim();
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixString)}`;
        document.getElementById('qr-image').src = qrUrl;

        setTimeout(() => {
            document.getElementById('loading-view').classList.add('hidden');
            document.getElementById('payment-view').classList.remove('hidden');
            startTimer('pix-timer', 20); 
        }, 2000);
    }

    function confirmPurchase() {
        // Adiciona ao histórico de compras
        if(!purchasedItems.includes(currentProduct.id)) {
            purchasedItems.push(currentProduct.id);
            localStorage.setItem('purchasedItems', JSON.stringify(purchasedItems));
        }
        
        alert("Pagamento confirmado! Seu pedido está sendo preparado.");
        window.location.reload(); // Recarrega para atualizar estado de compra
    }

    function clearUserData() {
        if(confirm("Tem certeza que deseja apagar seus dados salvos?")) {
            localStorage.removeItem('user_data');
            localStorage.removeItem('purchasedItems');
            purchasedItems = [];
            updateProfileUI();
            alert("Dados limpos com sucesso.");
        }
    }

    function copyPix() {
        const code = document.getElementById('pix-string').innerText;
        navigator.clipboard.writeText(code).then(() => {
            alert('Código Pix copiado com sucesso! Abra seu app do banco.');
        });
    }

    // --- TEMPORIZADOR ---

    function startTimer(elementId, hours) {
        let time = hours * 3600;
        const display = document.getElementById(elementId);
        
        if(window['timer_'+elementId]) clearInterval(window['timer_'+elementId]);

        window['timer_'+elementId] = setInterval(() => {
            let h = Math.floor(time / 3600);
            let m = Math.floor((time % 3600) / 60);
            let s = time % 60;
            
            h = h < 10 ? '0'+h : h;
            m = m < 10 ? '0'+m : m;
            s = s < 10 ? '0'+s : s;
            
            if(display) display.innerText = `${h}:${m}:${s}`;
            time--;

            if (time < 0) clearInterval(window['timer_'+elementId]);
        }, 1000);
    }

</script>

</body>
</html>
